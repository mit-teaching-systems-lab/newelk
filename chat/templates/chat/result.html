{% extends 'base.html' %}

{% block title %}Results{% endblock %}

{% block content %}

<style>
    table, tr {
        border-collapse: collapse;
        border: 1px solid black;
}
</style>

Here are your results!


<p id="results">Your quiz results:</p>
<table id="resultsTable">
</table>




Would you like to play again?
<button id="yes">yes</button> <button id="no">no</button>

<script>
    document.querySelector('#yes').onclick = function(e) {
        window.location.pathname = '/chat/';
    };
    document.querySelector('#no').onclick = function(e) {
        window.location.pathname = '/accounts/profile';
    };

</script>
<script>
    // window.onload=function() {
    var results = {{ quiz_results|safe }};
    if (Object.keys(results).length <= {{ participant_count }})
    {
        console.log('awaiting results, reloading in 10s')
        setTimeout(function () {
            location.reload(true)
        }, 10000);
    }
    else
    {
        var resultsTable = document.getElementById("resultsTable")
        var players = Object.keys(results)
        qpks = Object.keys(results.question_details);

        //Header row
        var tr = document.createElement("tr");
        var th = document.createElement("th");
        var txt = document.createTextNode("Player");
        th.appendChild(txt);
        tr.appendChild(th)
        for (q in qpks) {
            var th = document.createElement("th");
            var txt = document.createTextNode(
                Object.keys(results.question_details[qpks[q]])[0]
            )
            th.appendChild(txt);
            tr.appendChild(th)
        }
        resultsTable.appendChild(tr);

        //Answers row
        var tr = document.createElement("tr");
        var td = document.createElement("td");
        var txt = document.createTextNode("Correct Answer");
        td.appendChild(txt);
        tr.appendChild(td)
        for (q in qpks) {
            var td = document.createElement("td");
            var txt = document.createTextNode(
                Object.values(results.question_details[qpks[q]])[0]
            )
            td.appendChild(txt);
            tr.appendChild(td)
        }
        resultsTable.appendChild(tr);

        //Player results
        for (p in players) {
            var player = players[p]
            if (players[p] != "question_details") {
                var details = results[player]
                var tr = document.createElement("tr");
                var td = document.createElement("td");
                var txt = document.createTextNode(players[p]);
                td.appendChild(txt)
                tr.appendChild(td)
                for (q in qpks) {
                    var td = document.createElement("td")
                    // console.log(q)
                    // console.log(qpks)
                    // console.log(qpks[q])
                    // console.log(details)
                    // console.log(details[qpks[q]])
                    var txt = document.createTextNode(details[qpks[q]]);
                    td.appendChild(txt)
                    tr.appendChild(td)
                }
                resultsTable.appendChild(tr);
            }
        }
    }

</script>

{% endblock %}
